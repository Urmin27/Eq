<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription & Connexion</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #1a1a2e; color: white; }
        .container { width: 50%; margin: auto; padding: 20px; background: #16213e; border-radius: 10px; display: none; }
        input, button { margin: 10px; padding: 10px; font-size: 16px; }
        button { background: #00d4ff; color: white; border: none; cursor: pointer; }
        button:hover { background: #ffcc00; color: black; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h1>Programme de Parrainage</h1>
    <p id="invitationLinkContainer">
        <strong>Votre lien d'invitation :</strong> 
        <span id="invitationLink">G√©n√©ration...</span>
        <button onclick="copyInvitationLink()">üìã Copier</button>
    </p>

    <div class="container" id="signupForm">
        <h2>Inscription</h2>
        <input type="text" id="fullname" placeholder="Nom complet"><br>
        <input type="email" id="email" placeholder="Email"><br>
        <input type="text" id="phone" placeholder="T√©l√©phone"><br>
        <p>Captcha: <span id="captchaQuestion"></span></p>
        <input type="number" id="captchaAnswer" placeholder="Votre r√©ponse"><br>
        <input type="text" id="invitationCode" readonly><br>
        <button onclick="register()">S'inscrire</button><br>
        <p>D√©j√† un compte ? <a href="#" onclick="showLogin()">Connecte-toi</a></p>
    </div>

    <div class="container hidden" id="loginForm">
        <h2>Connexion</h2>
        <input type="text" id="loginPhone" placeholder="Num√©ro de t√©l√©phone"><br>
        <input type="password" id="loginPassword" placeholder="Mot de passe"><br>
        <button onclick="login()">Se connecter</button><br>
        <p><a href="#" onclick="forgotPassword()">Mot de passe oubli√© ?</a></p>
    </div>

    <script>
        function generateUserId() {
            return "USR" + Math.floor(Math.random() * 100000);
        }

        function generateInvitationLink(userId) {
            return window.location.origin + window.location.pathname + "?ref=" + userId;
        }

        function copyInvitationLink() {
            navigator.clipboard.writeText(document.getElementById("invitationLink").textContent)
                .then(() => alert("Lien copi√© !"));
        }

        let userId = localStorage.getItem("userId");
        if (!userId) {
            userId = generateUserId();
            localStorage.setItem("userId", userId);
        }

        document.getElementById("invitationLink").textContent = generateInvitationLink(userId);

        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get("ref");

        if (refCode) {
            document.getElementById("invitationLinkContainer").style.display = "none";
            document.getElementById("signupForm").style.display = "block";
            document.getElementById("invitationCode").value = refCode;
        }

        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            document.getElementById("captchaQuestion").textContent = `${num1} + ${num2} = ?`;
            return num1 + num2;
        }

        let correctCaptcha = generateCaptcha();

        function register() {
            const fullname = document.getElementById("fullname").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const captcha = parseInt(document.getElementById("captchaAnswer").value);
            const referrer = document.getElementById("invitationCode").value;

            let users = JSON.parse(localStorage.getItem("users")) || [];

            if (users.some(user => user.email === email || user.phone === phone)) {
                alert("Ce compte existe d√©j√† !");
                return;
            }

            if (captcha !== correctCaptcha) {
                alert("Captcha incorrect !");
                return;
            }

            let newUser = { fullname, email, phone, password: "1234", referrer, bonus: 0 };
            users.push(newUser);
            localStorage.setItem("users", JSON.stringify(users));

            let referrerUser = users.find(user => user.phone === referrer);
            if (referrerUser) {
                referrerUser.bonus = (referrerUser.bonus || 0) + 0.01;
                localStorage.setItem("users", JSON.stringify(users));
            }

            alert("Inscription r√©ussie !");
            document.getElementById("signupForm").classList.add("hidden");
            document.getElementById("loginForm").classList.remove("hidden");
        }

        function showLogin() {
            document.getElementById("signupForm").classList.add("hidden");
            document.getElementById("loginForm").classList.remove("hidden");
        }

        function login() {
            const phone = document.getElementById("loginPhone").value;
            const password = document.getElementById("loginPassword").value;
            let users = JSON.parse(localStorage.getItem("users")) || [];

            let user = users.find(u => u.phone === phone && u.password === password);
            if (!user) {
                alert("Utilisateur non trouv√© !");
                return;
            }

            alert("Connexion r√©ussie !");
            window.location.href = "https://site-web-asa-en-ligne-m-da-6fzi.vercel.app/";
        }

        function forgotPassword() {
            const phone = prompt("Entrez votre num√©ro de t√©l√©phone :");
            let users = JSON.parse(localStorage.getItem("users")) || [];

            let user = users.find(u => u.phone === phone);
            if (user) {
                alert("Votre mot de passe est : " + user.password);
            } else {
                alert("Num√©ro introuvable !");
            }
        }
    </script>
</body>
</html>
